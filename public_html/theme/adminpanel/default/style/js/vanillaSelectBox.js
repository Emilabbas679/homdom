/*
Copyright (C) Philippe Meyer 2019-2021
Distributed under the MIT License

vanillaSelectBox : v0.58 : Bug fixes
vanillaSelectBox : v0.57 : Bug fix (minWidth option not honored)
vanillaSelectBox : v0.56 : The multiselect checkboxes are a little smaller, maxWidth option is now working + added minWidth option as well
                           The button has now a style attribute to protect its appearance
vanillaSelectBox : v0.55 : All attributes from the original select options are copied to the selectBox element
vanillaSelectBox : v0.54 : if all the options of the select are selected by the user then the check all checkbox is checked
vanillaSelectBox : v0.53 : if all the options of the select are selected then the check all checkbox is checked
vanillaSelectBox : v0.52 : Better support of select('all') => command is consistent with checkbox and selecting / deselecting while searching select / uncheck only the found items
vanillaSelectBox : v0.51 : Translations for select all/clear all + minor css corrections + don't select disabled items
vanillaSelectBox : v0.50 : PR by jaguerra2017 adding a select all/clear all check button + optgroup support !
vanillaSelectBox : v0.41 : Bug corrected, the menu content was misplaced if a css transform was applied on a parent
vanillaSelectBox : v0.40 : A click on one selectBox close the other opened boxes
vanillaSelectBox : v0.35 : You can enable and disable items
vanillaSelectBox : v0.30 : The menu stops moving around on window resize and scroll + z-index in order of creation for multiple instances
vanillaSelectBox : v0.26 : Corrected bug in stayOpen mode with disable() function
vanillaSelectBox : v0.25 : New option stayOpen, and the dropbox is no longer a dropbox but a nice multi-select
previous version : v0.24 : corrected bug affecting options with more than one class
https://github.com/PhilippeMarcMeyer/vanillaSelectBox
*/

let VSBoxCounter=function(){let t=0,e=[];return{set:function(i){return e.push({offset:++t,ptr:i}),e[e.length-1].offset},remove:function(t){let i=e.filter(function(e){return e.offset!=t});e=i.splice(0),i=[]},closeAllButMe:function(t){temp=[],e.forEach(function(e){e.offset!=t&&e.ptr.closeOrder()})}}}();function vanillaSelectBox(t,e){if(this.instanceOffset=VSBoxCounter.set(this),this.domSelector=t,this.root=document.querySelector(t),this.main,this.button,this.title,this.isMultiple=this.root.hasAttribute("multiple"),this.multipleSize=this.isMultiple&&this.root.hasAttribute("size")?parseInt(this.root.getAttribute("size")):-1,this.drop,this.top,this.left,this.options,this.listElements,this.isDisabled=!1,this.search=!1,this.searchZone=null,this.inputBox=null,this.disabledItems=[],this.ulminWidth=140,this.ulminHeight=25,this.forbidenAttributes=["class","selected","disabled","data-text","data-value","style"],this.forbidenClasses=["active","disabled"],this.userOptions={minWidth:-1,maxHeight:400,translations:{all:"All",items:"items",selectAll:"Select All",clearAll:"Clear All"},search:!1,placeHolder:"",stayOpen:!1,disableSelectAll:!1},e){if(null!=e.maxWidth&&(this.userOptions.maxWidth=e.maxWidth),null!=e.minWidth&&(this.userOptions.minWidth=e.minWidth),null!=e.maxHeight&&(this.userOptions.maxHeight=e.maxHeight),null!=e.translations)for(var i in e.translations)e.translations.hasOwnProperty(i)&&this.userOptions.translations[i]&&(this.userOptions.translations[i]=e.translations[i]);null!=e.placeHolder&&(this.userOptions.placeHolder=e.placeHolder),null!=e.search&&(this.search=e.search),null!=e.stayOpen&&(this.userOptions.stayOpen=e.stayOpen),null!=e.disableSelectAll&&(this.userOptions.disableSelectAll=e.disableSelectAll)}this.closeOrder=function(){let t=this;t.userOptions.stayOpen||(t.drop.style.visibility="hidden",t.search&&(t.inputBox.value="",Array.prototype.slice.call(t.listElements).forEach(function(t){t.classList.remove("hide")})))},this.getCssArray=function(t){let e=[];return".vsb-main button"===t&&(e=[{key:"min-width",value:"120px"},{key:"width",value:"100%"},{key:"text-align",value:"left"},{key:"z-index",value:"1"},{key:"color",value:"#000"},{key:"background",value:"#fff"}]),function(t){let e="";return t.forEach(function(t){e+=t.key+":"+t.value+";"}),e}(e)},this.init=function(){let t=this;this.root.style.display="none";let e=document.getElementById("btn-group-"+t.domSelector);if(e&&e.remove(),this.main=document.createElement("div"),this.root.parentNode.insertBefore(this.main,this.root.nextSibling),this.main.classList.add("vsb-main"),this.main.setAttribute("id","btn-group-"+this.domSelector),this.main.style.marginLeft=this.main.style.marginLeft,t.userOptions.stayOpen&&(this.main.style.minHeight=this.userOptions.maxHeight+10+"px"),t.userOptions.stayOpen)this.button=document.createElement("div");else{this.button=document.createElement("button");var i=t.getCssArray(".vsb-main button");this.button.setAttribute("style",i)}this.button.style.maxWidth=this.userOptions.maxWidth+"px",-1!==this.userOptions.minWidth&&(this.button.style.minWidth=this.userOptions.minWidth+"px"),this.main.appendChild(this.button),this.title=document.createElement("span"),this.button.appendChild(this.title),this.title.classList.add("title");let s=document.createElement("span");if(this.button.appendChild(s),s.classList.add("caret"),s.style.position="absolute",s.style.right="0",s.style.marginTop="0",t.userOptions.stayOpen&&(s.style.display="none",this.title.style.paddingLeft="20px",this.title.style.fontStyle="italic",this.title.style.verticalAlign="20%"),this.drop=document.createElement("div"),this.main.appendChild(this.drop),this.drop.classList.add("vsb-menu"),this.drop.style.zIndex=2e3-this.instanceOffset,this.ul=document.createElement("ul"),this.drop.appendChild(this.ul),this.ul.style.maxHeight=this.userOptions.maxHeight+"px",this.ul.style.minWidth=this.ulminWidth+"px",this.ul.style.minHeight=this.ulminHeight+"px",this.isMultiple&&(this.ul.classList.add("multi"),!t.userOptions.disableSelectAll)){let e=document.createElement("option");e.setAttribute("value","all"),e.innerText=t.userOptions.translations.selectAll,this.root.insertBefore(e,this.root.hasChildNodes()?this.root.childNodes[0]:null)}let l="",a="",n=0;if(this.search){this.searchZone=document.createElement("div"),this.ul.appendChild(this.searchZone),this.searchZone.classList.add("vsb-js-search-zone"),this.searchZone.style.zIndex=2001-this.instanceOffset,this.inputBox=document.createElement("input"),this.searchZone.appendChild(this.inputBox),this.inputBox.setAttribute("type","text"),this.inputBox.setAttribute("id","search_"+this.domSelector);let e=this.isMultiple?"12px":"6px";var o=document.createElement("p");this.ul.appendChild(o),o.style.fontSize=e,o.innerHTML="&nbsp;",this.ul.addEventListener("scroll",function(e){var i=this.scrollTop;t.searchZone.parentNode.style.top=i+"px"})}if(this.options=document.querySelectorAll(this.domSelector+" > option"),Array.prototype.slice.call(this.options).forEach(function(e){let i,s=e.textContent,o=e.value;e.hasAttributes()&&(i=Array.prototype.slice.call(e.attributes).filter(function(e){return-1===t.forbidenAttributes.indexOf(e.name)}));let r=e.getAttribute("class");r=r?r.split(" ").filter(function(e){return-1===t.forbidenClasses.indexOf(e)}):[];let c=document.createElement("li"),u=e.hasAttribute("selected"),d=e.hasAttribute("disabled");t.ul.appendChild(c),c.setAttribute("data-value",o),c.setAttribute("data-text",s),void 0!==i&&i.forEach(function(t){c.setAttribute(t.name,t.value)}),r.forEach(function(t){c.classList.add(t)}),u&&(n++,l+=a+s,a=",",c.classList.add("active"),t.isMultiple||(t.title.textContent=s,0!=r.length&&r.forEach(function(e){t.title.classList.add(e)}))),d&&c.classList.add("disabled"),c.appendChild(document.createTextNode(s))}),null!==document.querySelector(this.domSelector+" optgroup")){this.options=document.querySelectorAll(this.domSelector+" option");let e=document.querySelectorAll(this.domSelector+" optgroup");Array.prototype.slice.call(e).forEach(function(e){let i=e.querySelectorAll("option"),s=document.createElement("li");s.classList.add("grouped-option"),s.appendChild(document.createTextNode(e.label)),t.ul.appendChild(s),Array.prototype.slice.call(i).forEach(function(e){let i=e.textContent,s=e.value,o=e.getAttribute("class");o=o?o.split(" "):[];let r=document.createElement("li"),c=e.hasAttribute("selected");t.ul.appendChild(r),r.setAttribute("data-value",s),r.setAttribute("data-text",i),0!=o.length&&o.forEach(function(t){r.classList.add(t)}),c&&(n++,l+=a+i,a=",",r.classList.add("active"),t.isMultiple||(t.title.textContent=i,0!=o.length&&o.forEach(function(e){t.title.classList.add(e)}))),r.appendChild(document.createTextNode(i))})})}if(-1!=t.multipleSize&&n>t.multipleSize){let e=t.userOptions.translations.items||"items";l=n+" "+e}function r(){document.removeEventListener("click",r),t.drop.style.visibility="hidden",t.search&&(t.inputBox.value="",Array.prototype.slice.call(t.listElements).forEach(function(t){t.classList.remove("hidden-search")}))}t.isMultiple&&(t.title.innerHTML=l),""!=t.userOptions.placeHolder&&""==t.title.textContent&&(t.title.textContent=t.userOptions.placeHolder),this.listElements=this.drop.querySelectorAll("li:not(.grouped-option)"),t.search&&t.inputBox.addEventListener("keyup",function(e){let i=e.target.value.toUpperCase(),s=i.length,l=0,a=0,n=null;s<2?Array.prototype.slice.call(t.listElements).forEach(function(t){"all"===t.getAttribute("data-value")?n=t:(t.classList.remove("hidden-search"),l++,a+=t.classList.contains("active"))}):Array.prototype.slice.call(t.listElements).forEach(function(t){if("all"!==t.getAttribute("data-value")){-1===t.getAttribute("data-text").toUpperCase().indexOf(i)&&"all"!==t.getAttribute("data-value")?t.classList.add("hidden-search"):(l++,t.classList.remove("hidden-search"),a+=t.classList.contains("active"))}else n=t}),n&&(0===l?n.classList.add("disabled"):n.classList.remove("disabled"),a!==l?(n.classList.remove("active"),n.innerText=t.userOptions.translations.selectAll,n.setAttribute("data-selected","false")):(n.classList.add("active"),n.innerText=t.userOptions.translations.clearAll,n.setAttribute("data-selected","true")))}),t.userOptions.stayOpen?(t.drop.style.visibility="visible",t.drop.style.boxShadow="none",t.drop.style.minHeight=this.userOptions.maxHeight+10+"px",t.drop.style.position="relative",t.drop.style.left="0px",t.drop.style.top="0px",t.button.style.border="none"):this.main.addEventListener("click",function(e){$(this).addClass('act'),t.isDisabled||(t.drop.style.left=t.left+"px",t.drop.style.top=t.top+"px",t.drop.style.visibility="visible",document.addEventListener("click",r),e.preventDefault(),e.stopPropagation(),t.userOptions.stayOpen||VSBoxCounter.closeAllButMe(t.instanceOffset))}),this.drop.addEventListener("click",function(e){if(t.isDisabled)return;if(!e.target.hasAttribute("data-value"))return e.preventDefault(),void e.stopPropagation();let i=e.target.getAttribute("data-value"),s=e.target.getAttribute("data-text"),l=e.target.getAttribute("class");if(!l||-1==l.indexOf("disabled"))if("all"!==i){if(t.isMultiple){let s=!1;l&&(s=-1!=l.indexOf("active")),s?e.target.classList.remove("active"):e.target.classList.add("active");let a="",n="",o=0,r=0;for(let e=0;e<t.options.length;e++)r++,t.options[e].value==i&&(t.options[e].selected=!s),t.options[e].selected&&(o++,a+=n+t.options[e].textContent,n=",");if(r==o){a=t.userOptions.translations.all||"all"}else if(-1!=t.multipleSize&&o>t.multipleSize){a=o+" "+(t.userOptions.translations.items||"items")}t.title.textContent=a,t.checkUncheckAll(),t.privateSendChange()}else t.root.value=i,t.title.textContent=s,l?t.title.setAttribute("class",l+" title"):t.title.setAttribute("class","title"),Array.prototype.slice.call(t.listElements).forEach(function(t){t.classList.remove("active")}),""!=s&&e.target.classList.add("active"),t.privateSendChange(),t.userOptions.stayOpen||r();e.preventDefault(),e.stopPropagation(),""!=t.userOptions.placeHolder&&""==t.title.textContent&&(t.title.textContent=t.userOptions.placeHolder)}else e.target.hasAttribute("data-selected")&&"true"===e.target.getAttribute("data-selected")?t.setValue("none"):t.setValue("all")})},this.init(),this.checkUncheckAll()}function vanillaSelectBox_type(t){return Object.prototype.toString.call(t).replace("[object ","").replace("]","").toLowerCase()}vanillaSelectBox.prototype.disableItems=function(t){let e=this,i=[];"string"==vanillaSelectBox_type(t)&&(t=t.split(",")),"array"==vanillaSelectBox_type(t)&&Array.prototype.slice.call(e.options).forEach(function(e){-1!=t.indexOf(e.value)&&(i.push(e.value),e.setAttribute("disabled",""))}),Array.prototype.slice.call(e.listElements).forEach(function(t){let e=t.getAttribute("data-value");-1!=i.indexOf(e)&&t.classList.add("disabled")})},vanillaSelectBox.prototype.enableItems=function(t){let e=this,i=[];"string"==vanillaSelectBox_type(t)&&(t=t.split(",")),"array"==vanillaSelectBox_type(t)&&Array.prototype.slice.call(e.options).forEach(function(e){-1!=t.indexOf(e.value)&&(i.push(e.value),e.removeAttribute("disabled"))}),Array.prototype.slice.call(e.listElements).forEach(function(t){-1!=i.indexOf(t.getAttribute("data-value"))&&t.classList.remove("disabled")})},vanillaSelectBox.prototype.checkUncheckAll=function(){let t=this;if(t.isMultiple){let e=0,i=0,s=null;Array.prototype.slice.call(t.listElements).forEach(function(t){t.hasAttribute("data-value")&&("all"===t.getAttribute("data-value")&&(s=t),"all"===t.getAttribute("data-value")||t.classList.contains("hidden-search")||t.classList.contains("disabled")||(i++,e+=t.classList.contains("active")))}),s&&(e===i?(s.classList.add("active"),s.innerText=t.userOptions.translations.clearAll,s.setAttribute("data-selected","true")):0===e&&(s.classList.remove("active"),s.innerText=t.userOptions.translations.selectAll,s.setAttribute("data-selected","false")))}},vanillaSelectBox.prototype.setValue=function(t){let e=this;if(null==t||null==t||""==t)e.empty();else if(e.isMultiple){"string"==vanillaSelectBox_type(t)&&("all"===t?(t=[],Array.prototype.slice.call(e.listElements).forEach(function(e){if(e.hasAttribute("data-value")){let i=e.getAttribute("data-value");"all"!==i&&(e.classList.contains("hidden-search")||e.classList.contains("disabled")||t.push(e.getAttribute("data-value")),e.classList.contains("active")&&(e.classList.contains("hidden-search")||e.classList.contains("disabled"))&&t.push(i))}})):"none"===t?(t=[],Array.prototype.slice.call(e.listElements).forEach(function(e){if(e.hasAttribute("data-value")){let i=e.getAttribute("data-value");"all"!==i&&e.classList.contains("active")&&(e.classList.contains("hidden-search")||e.classList.contains("disabled"))&&t.push(i)}})):t=t.split(","));let i=[];if("array"==vanillaSelectBox_type(t)){Array.prototype.slice.call(e.options).forEach(function(e){-1!==t.indexOf(e.value)?(e.selected=!0,i.push(e.value)):e.selected=!1});let s="",l="",a=0,n=0;if(Array.prototype.slice.call(e.listElements).forEach(function(t){n++,-1!=i.indexOf(t.getAttribute("data-value"))?(t.classList.add("active"),a++,s+=l+t.getAttribute("data-text"),l=","):t.classList.remove("active")}),n==a){let t=e.userOptions.translations.all||"all";s=t}else if(-1!=e.multipleSize&&a>e.multipleSize){let t=e.userOptions.translations.items||"items";s=a+" "+t}e.title.textContent=s,e.privateSendChange()}e.checkUncheckAll()}else{let i=!1,s="";Array.prototype.slice.call(e.listElements).forEach(function(e){e.getAttribute("data-value")==t?(e.classList.add("active"),i=!0,s=e.getAttribute("data-text")):e.classList.remove("active")}),Array.prototype.slice.call(e.options).forEach(function(e){e.value==t?(e.selected=!0,className=e.getAttribute("class"),className||(className="")):e.selected=!1}),i&&(e.title.textContent=s,""!=e.userOptions.placeHolder&&""==e.title.textContent&&(e.title.textContent=e.userOptions.placeHolder),""!=className?e.title.setAttribute("class",className+" title"):e.title.setAttribute("class","title"))}},vanillaSelectBox.prototype.privateSendChange=function(){let t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.root.dispatchEvent(t)},vanillaSelectBox.prototype.empty=function(){Array.prototype.slice.call(this.listElements).forEach(function(t){t.classList.remove("active")}),Array.prototype.slice.call(this.options).forEach(function(t){t.selected=!1}),this.title.textContent="",""!=this.userOptions.placeHolder&&""==this.title.textContent&&(this.title.textContent=this.userOptions.placeHolder),this.checkUncheckAll(),this.privateSendChange()},vanillaSelectBox.prototype.destroy=function(){let t=document.getElementById("btn-group-"+this.domSelector);t&&(VSBoxCounter.remove(this.instanceOffset),t.remove(),this.root.style.display="inline-block")},vanillaSelectBox.prototype.disable=function(){let t=document.getElementById("btn-group-"+this.domSelector);t&&(button=t.querySelector("button"),button&&button.classList.add("disabled"),this.isDisabled=!0)},vanillaSelectBox.prototype.enable=function(){let t=document.getElementById("btn-group-"+this.domSelector);t&&(button=t.querySelector("button"),button&&button.classList.remove("disabled"),this.isDisabled=!1)},vanillaSelectBox.prototype.showOptions=function(){console.log(this.userOptions)},"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});
